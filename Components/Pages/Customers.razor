@page "/customers"

@inherits NeocoreComponent

@inject CustomerRepository CustomerRepository

<RoleGuard MinimumRole="UserRole.Editor">
    <h3 class="mt-2">
        Customers
        <a href="/customer" class="btn btn-sm ms-2 py-1 btn-success">+ New</a>
    </h3>

    <QuickGrid class="nc-grid" Items="CustomerList.AsQueryable()" Pagination="paginationState">
        <TemplateColumn class="nc-narrow" Title="Id"
                        SortBy="GridSort<Customer>.ByAscending(i => i.Id)">
            <a href="customer/@context.Id">@context.Id</a>
        </TemplateColumn>
        <TemplateColumn Title="Full name" SortBy="GridSort<Customer>.ByAscending(i => i.FullName)">
            @context.FullName
        </TemplateColumn>
        <Paginator State="paginationState" />
    </QuickGrid>
</RoleGuard>

@code {
    private PaginationState paginationState = new() { ItemsPerPage = 10 };

    public List<Customer> CustomerList { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        if (!IsPrerendering)
        {
            CustomerList = [.. await CustomerRepository.FindAll()];
        }

        await base.OnInitializedAsync();
    }
}
